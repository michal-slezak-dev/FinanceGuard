{% extends 'base.html' %}
{% from 'bootstrap4/form.html' import render_form %}

{% block styling %}
    {{ super() }}

    .flash {
        background-color: rgba(0, 0, 0, 0.5);
    }

    #budget_name, #limit_amount, .container {
        background-color: rgba(0, 0, 0, 0.7);
    }

    .container {
        padding-top: 1em;
        border-radius: 3%;
    }

    a.nav-link, div>a {
        display: block;
        text-decoration: none;
        color: rgba(255, 255, 255, 1);
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
        overflow: auto;
    }

    .modal-content {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
        background-color: rgba(0, 0, 0, 0.7);
        padding: 2em;
        border-radius: 1em;
        box-shadow: 0.5em 0.75em rgba(0, 0, 0, 0.3);
        width: 90%;
        max-width: 500px;
    }

    #category_choice {
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 0.25rem;
        padding: 0.75rem 1rem;
        height: calc(3.5rem + 2px);
        width: 100%;
    }

    #category_choice:focus {
        color: white;
        background-color: rgba(0, 0, 0, 0.7);
        border-color: #86b7fe;
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

{% endblock %}

{% block nav %}
        <a class="nav-link fw-bold py-1 px-0" aria-current="page" href="{{ url_for('platform_homepage') }}">Dashboard</a>
        <a class="nav-link fw-bold py-1 px-0" href="{{ url_for('logout') }}">Logout</a>
{% endblock %}

{% block content %}
    <h1>Hello, {{ current_user.name }}!</h1>
    <h3>Here are your budgets</h3>
    <form method="POST" action="{{ url_for('show_budgets') }}">
        {{ popup_form.csrf_token }}
        {{ popup_form.hidden_tag() }}
        {{ popup_form.add_budget }}
    </form>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <p class="flash">{{ message }}</p>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if modal %}
        <div class="modal" style="display: block;">
            <div class="modal-content rounded-4 shadow">
                <div class="modal-header p-5 pb-4 border-bottom-0">
                    <h1 class="fw-bold mb-0 fs-2">Add Budget</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                  <div class="modal-body p-5 pt-0">
                    <form method="POST" novalidate>
                          {{ form_add.csrf_token }}
                          {{ form_add.hidden_tag() }}
                      <div class="form-floating mb-3">
                          {{ form_add.budget_name }}
                          <label for="budget_name">Budget Name</label>
                          {% if form_add.budget_name.errors and form_add.is_submitted() %}
                            <div class="text-danger">
                                {% for error in form_add.budget_name.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                          {% endif %}
                      </div>
                        <div class="form-floating mb-3">
                          {{ form_add.category_choice }}
<!--                          <label for="category_choice">Category</label>-->
                          {% if form_add.category_choice.errors  and form_add.is_submitted() %}
                            <div class="text-danger">
                                {% for error in form_add.category_choice.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                          {% endif %}
                      </div>
                      <div class="form-floating mb-3">
                          {{ form_add.limit_amount }}
                          <label for="limit_amount">Limit Amount</label>
                          {% if form_add.limit_amount.errors  and form_add.is_submitted() %}
                            <div class="text-danger">
                                {% for error in form_add.limit_amount.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                          {% endif %}
                      </div>
                      {{ form_add.add_budget }}
                    </form>
                  </div>
            </div>
        </div>
    {% endif %}

    {% if budgets %}
    <div class="container">
            {% for budget in budgets %}
                <div class="row">
                    <div class="col-sm">
                        <p>{{ budget.budget_name }} {{ budget.limit_amount }} {{ budget.spent_amount }} {{ budget.category.category_name }}</p>
                    </div>
                </div>
            {% endfor %}
    </div>
    {% endif %}
{% endblock %}

{%block additional_js %}
    <script src="{{ url_for('static', filename='js/popup.js') }}"></script>
{% endblock %}

